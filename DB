DROP DATABASE IF EXISTS MEOW;
CREATE DATABASE MEOW;
USE MEOW;

### article 테이블
CREATE TABLE article(
	id INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
	regDate DATETIME NOT NULL,
	updateDate DATETIME NOT NULL,
	memberId INT UNSIGNED NOT NULL,
	boardId INT UNSIGNED NOT NULL,
	title VARCHAR(50) NOT NULL,
	`body` TEXT NOT NULL
);

### member 테이블
CREATE TABLE `member` (
  	id INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT COMMENT '회원 번호',
  	regDate DATETIME NOT NULL COMMENT '가입일',
  	updateDate DATETIME NOT NULL COMMENT '수정일',
  	loginId VARCHAR(20) NOT NULL UNIQUE COMMENT '아이디',
	loginPw VARCHAR(64) NOT NULL COMMENT '비밀번호',
	authLevel INT UNSIGNED NOT NULL DEFAULT 1 COMMENT '권한 레벨 (일반 = 1, 관리자 = 0)',
 	`name` VARCHAR(50) NOT NULL COMMENT '이름',
 	nickname VARCHAR(255) NOT NULL UNIQUE COMMENT '닉네임',
 	age INT UNSIGNED NOT NULL COMMENT '나이',
 	address TEXT NOT NULL COMMENT '주소, json형태',
 	cellphoneNum VARCHAR(20) NOT NULL COMMENT '전화번호',
  	email VARCHAR(50) NOT NULL UNIQUE COMMENT '이메일',
 	`status` INT UNSIGNED NOT NULL DEFAULT 0 COMMENT '회원 상태 (활동 = 0, 정지 = 1, 휴면 = 2, 탈퇴 = 3, 강제 탈퇴 = 4)',
  	lastLoginDate DATETIME COMMENT '마지막 로그인 일시',
 	lastLoginDays INT UNSIGNED NOT NULL DEFAULT 0 COMMENT '미접속일',
  	profileImage VARCHAR(255) COMMENT '프로필사진 파일명',
 	aboutMe VARCHAR(100) COMMENT '자기소개'
);

### sns_info 테이블
CREATE TABLE sns_info (
  id INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT COMMENT '소셜 로그인 회원번호',
  snsId VARCHAR(255) NOT NULL UNIQUE COMMENT '소셜 로그인 계정 고유ID',
  snsConnectDate DATETIME NULL COMMENT '첫 소셜 로그인 일',
  snsType VARCHAR(10) NOT NULL COMMENT 'SNS 타입 (naver, kakao, google)',
  memberId INT UNSIGNED NOT NULL,
  `name` VARCHAR(255) NOT NULL COMMENT '소셜 계정 이름',
  mobile VARCHAR(20) NULL COMMENT '소셜 계정 전화번호',
  email VARCHAR(255) NULL COMMENT '소셜 계정 이메일'
);

### member_deletion_reason 테이블
CREATE TABLE member_deletion_reason (
    id INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
    regDate DATETIME NOT NULL COMMENT '탈퇴일',
	updateDate DATETIME NOT NULL,
    memberId INT UNSIGNED NOT NULL,
    deletionReasonCode VARCHAR(20) NOT NULL COMMENT '복수선택, 1 = 콘텐츠 불만족, 2 = 부정적인 커뮤니티 경험, 3 = 다른 서비스 이용, 4 = 이용 빈도 낮음, 5 = 서비스 불만족, 6 = 직접 입력',
    customDeletionReason VARCHAR(100) COMMENT '직접 입력 데이터 (100글자 제한)'
);

### companion_cat 테이블
CREATE TABLE companion_cat (
  	id INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT COMMENT '반려묘 번호',
  	regDate DATETIME NOT NULL COMMENT '등록일',
  	updateDate DATETIME NOT NULL COMMENT '수정일',
  	memberId INT UNSIGNED NOT NULL COMMENT '유저 ID',
 	`name` VARCHAR(50) NOT NULL COMMENT '이름',
 	gender VARCHAR(1) NOT NULL '성별',
 	birthDate DATE COMMENT '필수X, 생년월일',
 	profileImage VARCHAR(255) COMMENT '프로필사진',
 	aboutCat VARCHAR(100) COMMENT '반려묘 소개'
);

### board 테이블
CREATE TABLE board(
	id INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
	regDate DATETIME NOT NULL,
	updateDate DATETIME NOT NULL,
	`CODE` VARCHAR(20) NOT NULL COMMENT 'all, notice, free, catCompanion, trade, meeting',
	`NAME` VARCHAR(20) NOT NULL COMMENT '전체, 공지사항, 자유, 반려묘, 거래, 모임'
);


### friend 테이블
CREATE TABLE friend (
  id INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT COMMENT '친구 관계 번호',
  requestDate DATETIME NOT NULL COMMENT '친구 요청일',
  acceptDate DATETIME COMMENT '친구 수락일',
  refuseDate DATETIME COMMENT '친구 거절일',
  senderId INT UNSIGNED NOT NULL COMMENT '요청 회원 ID',
  receiverId INT UNSIGNED NOT NULL COMMENT '응답 회원 ID',
  `status` VARCHAR(10) NULL DEFAULT 'pending' COMMENT '친구 요청 상태, 보류 = pending, 수락 = accepted, 거절 = refuse'
);

### chat 테이블 
CREATE TABLE chat (
    id INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT COMMENT '방 번호',
    openDate DATETIME NOT NULL COMMENT '개설일',
    closeDate DATETIME NULL COMMENT '종료일',
    createrId INT UNSIGNED NOT NULL COMMENT '개설자 ID'
);

### req_res 테이블
CREATE TABLE req_res (
    id INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT COMMENT '요청 번호',
    requesterId INT NOT NULL COMMENT '요청 보낸 회원 ID',
    recipientId INT NOT NULL COMMENT '응답 받는 회원 ID',
    `status` VARCHAR(10) NULL DEFAULT 'pending' COMMENT '친구 요청 상태, 보류 = pending, 수락 = accepted, 거절 = refuse',
    `code` VARCHAR(20) NOT NULL COMMENT '요청 코드(friend, chat)'
);


### recommendPoint 테이블
CREATE TABLE recommendPoint(
	id INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
	memberId INT UNSIGNED NOT NULL,
    relTypeCode VARCHAR(20) NOT NULL COMMENT '관련 데이터 타입 코드',
    relId INT UNSIGNED NOT NULL COMMENT '관련 데이터 번호',
    `point` INT UNSIGNED NOT NULL DEFAULT 0
);

### reply 테이블
CREATE TABLE reply(
	id INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
	regDate DATETIME NOT NULL,
	updateDate DATETIME NOT NULL,
	memberId INT UNSIGNED NOT NULL,
	relTypeCode VARCHAR(20) NOT NULL COMMENT '관련 데이터 타입 코드',
	relId INT UNSIGNED NOT NULL COMMENT '관련 데이터 번호',
	`body` TEXT NOT NULL
);


## 테스트 데이터
### article
INSERT INTO article
SET regDate = NOW(),
updateDate = NOW(),
memberId = 1,
boardId = FLOOR(RAND() * 6 + 1),
title = CONCAT('테스트 제목_', FLOOR(RAND() * 10000 + 1)),
`body` = CONCAT('테스트 내용_', FLOOR(RAND() * 10000 + 1));

INSERT INTO article
SET regDate = NOW(),
updateDate = NOW(),
memberId = 2,
boardId = FLOOR(RAND() * 4 + 3),
title = CONCAT('테스트 제목_', FLOOR(RAND() * 10000 + 1)),
`body` = CONCAT('테스트 내용_', FLOOR(RAND() * 10000 + 1));

INSERT INTO article
SET regDate = NOW(),
updateDate = NOW(),
memberId = 3,
boardId = FLOOR(RAND() * 4 + 3),
title = CONCAT('테스트 제목_', FLOOR(RAND() * 10000 + 1)),
`body` = CONCAT('테스트 내용_', FLOOR(RAND() * 10000 + 1));


### member
INSERT INTO `member`
SET regDate = NOW(),
updateDate = NOW(),
loginId = 'admin',
loginPw = '8c6976e5b5410415bde908bd4dee15dfb167a9c873fc4bb8a81f6f2ab448a918',		# admin
authLevel = 0,
`name` = '관리자',
nickname = '관리자',
age = 24,
address = '{"zonecode": "34134", "sido": "대전", "sigungu": "유성구", "bname": "궁동", "jibunAddress": "", "roadAddress": "대전 유성구 대학로 99", "detailAddress": ""}',
cellphoneNum = '01020000208',
email = 'admin@admin.com',
lastLoginDate = NOW();

INSERT INTO `member`
SET regDate = NOW(),
updateDate = NOW(),
loginId = 'testId01',
loginPw = '3237e2749c5fb3bec0053123a7585e8cfac345753a2d9aadb8d082da065f9fc2',		# testPw01!@
`name` = '테스트1',
nickname = '테스트1',
age = 50,
address = '{"zonecode": "34136", "sido": "대전", "sigungu": "유성구", "bname": "장대동", "jibunAddress": "대전 유성구 장대동 316-8", "roadAddress": "대전 유성구 유성대로822번길 29", "detailAddress": "신성빌라 303호"}',
cellphoneNum = '01000010001',
email = 'test1@test.com',
lastLoginDate = NOW();

INSERT INTO `member`
SET regDate = NOW(),
updateDate = NOW(),
loginId = 'testId02',
loginPw = '47af0d2d6601bde1ca27b7c8f48bb8e53c87e78b899a8d0c6c2fb4f66917354f',		# testPw02!@
`name` = '테스트2',
nickname = '테스트2',
age = 30,
address = {"zonecode": "35272", "sido": "대전", "sigungu": "서구", "bname": "갈마동", "jibunAddress": "대전 서구 갈마동 349-1", "roadAddress": "대전 서구 갈마중로16번길 17", "detailAddress": "향백하우스 201호"},
cellphoneNum = '01000020002',
email = 'test2@test.com',
lastLoginDate = NOW();


### companion_cat
INSERT INTO companion_cat
SET regDate = NOW()
    , updateDate = NOW()
    , memberId = 2
    , `name` = '하늘'
    , gender = 'M'
    , birthDate = '2020-02-16'
    , aboutCat = '안녕하세요. 하늘입니다.';

INSERT INTO companion_cat
SET regDate = NOW()
    , updateDate = NOW()
    , memberId = 2
    , `name` = '하루'
    , gender = 'M'
    , birthDate = '2016-05-24'
    , aboutCat = '안녕하세요. 하루입니다.';

INSERT INTO companion_cat
SET regDate = NOW()
    , updateDate = NOW()
    , memberId = 2
    , `name` = '하나'
    , gender = 'F'
    , birthDate = '2016-12-24'
    , aboutCat = '안녕하세요. 하나입니다.';

INSERT INTO companion_cat
SET regDate = NOW()
    , updateDate = NOW()
    , memberId = 2
    , `name` = '하니'
    , gender = 'F'
    , birthDate = '2020-11-11'
    , aboutCat = '안녕하세요. 하니입니다.';
    
INSERT INTO companion_cat
SET regDate = NOW()
    , updateDate = NOW()
    , memberId = 2
    , `name` = '하하하'
    , gender = 'M'
    , birthDate = '2014-01-01'
    , aboutCat = '안녕하세요. 하하하입니다.';


### board
INSERT INTO board
SET regDate = NOW(),
updateDate = NOW(),
`code` = 'all',
`name` = '전체';

INSERT INTO board
SET regDate = NOW(),
updateDate = NOW(),
`code` = 'notice',
`name` = '공지사항';

INSERT INTO board
SET regDate = NOW(),
updateDate = NOW(),
`code` = 'free',
`name` = '자유';

INSERT INTO board
SET regDate = NOW(),
updateDate = NOW(),
`code` = 'catCompanion',
`name` = '반려묘';

INSERT INTO board
SET regDate = NOW(),
updateDate = NOW(),
`code` = 'trade',
`name` = '거래';

INSERT INTO board
SET regDate = NOW(),
updateDate = NOW(),
`code` = 'meeting',
`name` = '모임';